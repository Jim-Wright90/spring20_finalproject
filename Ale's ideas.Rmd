---
title: "Ale's ideas"
author: "Alejandra Garcia Isaza"
date: "5/21/2020"
output: html_document
---

Some questions: https://www.childhealthdata.org/learn-about-the-nsch/topics_questions/2017-nsch-guide-to-topics-and-questions 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rio)
library(here)

theme_set(theme_minimal())
```

```{r}
NCSH <- import(here("data","2017-2018 NSCH_Topical_DRC_Dec 2019.csv"), setclass = "tbl_df")

state <- import(here("data","fips_state.csv"))

# Left_join to add states in the NCSH dataset
final_data <- left_join(NCSH, state, by = "FIPSST")
```

```{r}
# data prep

selected_data <- final_data %>%
  select(HHID, HHLANGUAGE, SC_AGE_YEARS, SC_SEX, MOMAGE, HHCOUNT, K6Q20, K11Q60, K11Q61, K11Q62, S9Q34, K10Q14, ACE1, ACE3, ACE4, ACE5, ACE6, ACE7, ACE8, ACE9, ACE10, RECOGABC, A1_GRADE, A2_GRADE, K6Q60_R, K6Q61_R, FOODSIT, K8Q30, CONFIDENT, povlev4_1718, AdultEduc_1718, WrkngPoor_1718, ACEct_1718, ACE2more_1718, State) %>%
  janitor::clean_names() %>% # cleaning names
  filter(sc_age_years == 5) # filtering for 5 years old
```

values of missing data:

a2_grade # this one has missing data as 95 and 99
foodsit # this one has missing data as 99
k6q60_r # this one has missing data as 90
wrkng_poor_1718 # this one has missing data as 99

```{r}
# creating a function to recode missing data

# vector with missing values in my dataset
missing_vals <- c(90, 95, 99)

# function that returns true if values in vector are equal to missing_vals. The function takes a vector x, and specified values of missing data
recode_missing <- function(x, missing_vals = c(90, 95, 99)) {
  test <- x %in% missing_vals
  ifelse(test, NA, x)
}

# function that recodes missing values to NA. The function takes a dataframe with variables with missing data, and specified values of missing data
recode_missing_df <- function(df, missing_vals = c(90, 95, 99)) {
  modify(df, ~recode_missing(.x, missing_vals)) # here uses the function created above
}
```

* SELECTED QUESTIONS *

1. DURING THE PAST WEEK, how many days did you or other family members tell stories or sing songs to this child? (stories_songs)

2. DURING THE PAST WEEK, how many days did you or other family members read to this child? (read)

3. How confident are you that this child is ready to be in school? (confident)

4. How well do you think you are handling the day-to-day demands of raising children? (how_well_demands)

5. What is the highest grade or level of school you have completed? Mark (X) ONE box. (primary_cg_ed)

```{r}
# more data cleaning

d <- recode_missing_df(selected_data) %>%
  drop_na() %>% # dropping cases with missing data
  mutate(stories_songs = factor(k6q61_r),
         stories_songs = fct_recode(stories_songs,
                           "0 days" = "1",
                           "1-3 days" = "2",
                           "4-6 days" = "3",
                           "Every day" = "4"),
         read = factor(k6q60_r),
         read = fct_recode(read,
                           "0 days" = "1",
                           "1-3 days" = "2",
                           "4-6 days" = "3",
                           "Every day" = "4"),
         confident = factor(confident),
         confident = fct_recode(confident,
                           "Completely confident" = "1",
                           "Mostly confident" = "2",
                           "Somewhat confident" = "3",
                           "Not at all confident" = "4"),
         how_well_demands = factor(k8q30),
         how_well_demands = fct_recode(how_well_demands,
                           "Very well" = "1",
                           "Somewhat well" = "2",
                           "Not very well" = "3",
                           "Not at all" = "4"),
         primary_cg_ed = factor(a1_grade),
         primary_cg_ed = fct_recode(primary_cg_ed,
                           "8th grade or less" = "1",
                           "9th-12th grade; No diploma" = "2",
                           "High School Graduate or GED" = "3",
                           "Vocational, trade, or business school program" = "4",
                           "Some College Credit, no Degree" = "5",
                           "Associate Degree" = "6",
                           "Bachelor’s Degree" = "7",
                           "Master’s Degree" = "8",
                           "Doctorate" = "9")) %>%
  select(1:4, stories_songs, read, confident, how_well_demands, primary_cg_ed)
```

```{r}
# creating a list for each education level with all the variables - base way:
# by_ed_level <- split(d, d$a1_grade)

# using nest to create list columns
by_ed_level <- d %>%
  group_by(primary_cg_ed) %>% 
  nest()

by_ed_level 

str(by_ed_level$data)
```


```{r}
# plot confidence vs. reading

ggplot(d, aes(read, confident)) +
  geom_jitter(color = "cornflowerblue") +
  facet_wrap(~primary_cg_ed)
```

```{r}
# plot confidence vs. primary caregiver level of education

ggplot(d, aes(primary_cg_ed, confident)) +
  geom_jitter(color = "blue") +
  coord_flip()
```

```{r}
# plot reading vs. primary caregiver level of education

ggplot(d, aes(primary_cg_ed, read)) +
  geom_jitter(color = "#9516A1") +
  coord_flip()
```


